{include file='public/meta' /}
<body>
<div class="x-body">
    <form class="layui-form">
        <div class="layui-form-item">
            <label for="name" class="layui-form-label">
                <span class="x-red">*</span>产品名称
            </label>
            <div class="layui-input-inline">
                <input type="text" id="name" name="name" required="" lay-verify="required"
                       autocomplete="off" value="{$product->name}" class="layui-input">
            </div>

            <label for="loan_time" class="layui-form-label">
                <span class="x-red">*</span>放款时间
            </label>
            <div class="layui-input-inline">
                <input type="text" id="loan_time" name="loan_time" required="" lay-verify="required"
                       autocomplete="off" value="{$product->loan_time}" class="layui-input">
            </div>

            <label class="layui-form-label"><span class="x-red">*</span>分类</label>
            <div class="layui-input-inline">
                <select name="category_id" lay-verify="required">
                    {foreach $categorys as $v}
                        {if $v->id == $product->category_id}
                            <option selected value="{$v->id}">{$v->name}</option>
                        {else /}
                            <option value="{$v->id}">{$v->name}</option>
                        {/if}
                    {/foreach}
                </select>
            </div>
        </div>

        <div class="layui-form-item">
            <label for="money" class="layui-form-label">
                <span class="x-red">*</span>额度
            </label>
            <div class="layui-input-inline">
                <input type="text" value="{$product->money}" id="money" name="money" required="" lay-verify="required"
                       autocomplete="off" class="layui-input">
            </div>

            <label for="money_section" class="layui-form-label">
                <span class="x-red">*</span>额度区间
            </label>
            <div class="layui-input-inline">
                <select name="money_section" lay-verify="required">
                    {foreach $period_section as $v}
                    {if $product->money_section == $v}
                    <option value="{$v}" selected>{$v}</option>
                    {else /}
                    <option value="{$v}">{$v}</option>
                    {/if}
                    {/foreach}
                </select>
            </div>

            <label for="card" class="layui-form-label">
                <span class="x-red">*</span>身份
            </label>
            <div class="layui-input-inline">
                <select name="card" lay-verify="required">
                    {foreach $card as $v}
                    {if $product->card == $v}
                    <option value="{$v}" selected>{$v}</option>
                    {else /}
                    <option value="{$v}">{$v}</option>
                    {/if}
                    {/foreach}
                </select>
            </div>
        </div>

        <div class="layui-form-item">
            <label for="interest_rate" class="layui-form-label">
                <span class="x-red">*</span>利率
            </label>
            <div class="layui-input-inline">
                <input type="text" id="interest_rate" name="interest_rate" required="" lay-verify="pass"
                       autocomplete="off" value="{$product->interest_rate}" class="layui-input">
            </div>

            <label for="loan_period" class="layui-form-label">
                <span class="x-red">*</span>贷款期限
            </label>
            <div class="layui-input-inline">
                <input type="text" id="loan_period" name="loan_period" required="" lay-verify="required"
                       autocomplete="off" value="{$product->loan_period}" class="layui-input">
            </div>

            <label for="period_section" class="layui-form-label">
                <span class="x-red">*</span>期限区间
            </label>
            <div class="layui-input-inline">
                <select name="period_section" lay-verify="required">
                    {foreach $period_section as $v}
                    {if $product->period_section == $v}
                    <option value="{$v}" selected>{$v}</option>
                    {else /}
                    <option value="{$v}">{$v}</option>
                    {/if}
                    {/foreach}
                </select>
            </div>
        </div>

        <div class="layui-form-item">
            <label for="product_url" class="layui-form-label">
                <span class="x-red">*</span>产品链接
            </label>
            <div class="layui-input-inline">
                <input type="text" id="product_url" name="product_url" required="" lay-verify="required"
                       autocomplete="off" value="{$product->product_url}" class="layui-input">
            </div>

            <label for="identity" class="layui-form-label">
                <span class="x-red">*</span>身份证明
            </label>
            <div class="layui-input-inline">
                <input type="text" id="identity" name="identity" required="" lay-verify="required"
                       autocomplete="off" value="{$product->identity}" class="layui-input">
            </div>

            <label for="product_introduction" class="layui-form-label">
                <span class="x-red">*</span>产品简介
            </label>
            <div class="layui-input-inline">
                <input type="text" id="product_introduction" name="product_introduction" required="" lay-verify="required"
                       autocomplete="off" value="{$product->product_introduction}" class="layui-input">
            </div>
        </div>

        <div class="layui-form-item">
            <label for="auxiliary" class="layui-form-label">
                <span class="x-red">*</span>辅助文件
            </label>
            <div class="layui-input-inline">
                <input type="text" id="auxiliary" name="auxiliary" required="" lay-verify="required"
                       autocomplete="off" value="{$product->auxiliary}" class="layui-input">
            </div>

            <label for="require_age" class="layui-form-label">
                <span class="x-red">*</span>年龄要求
            </label>
            <div class="layui-input-inline">
                <input type="text" id="require_age" name="require_age" required="" lay-verify="required"
                       autocomplete="off" value="{$product->require_age}" class="layui-input">
            </div>

            <label for="sesame" class="layui-form-label">
                <span class="x-red">*</span>芝麻分要求
            </label>
            <div class="layui-input-inline">
                <input type="text" id="sesame" name="sesame" required="" lay-verify="required"
                       autocomplete="off" value="{$product->sesame}" class="layui-input">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">产品标签</label>
            <div class="layui-input-block">
                {foreach $tags as $tag}
                    {if (in_array($product->id,$tag->product->column('id'))) }
                        <input type="checkbox" name="tag[]" checked title="{$tag->name}" value="{$tag->id}" lay-skin="primary">
                    {else /}
                        <input type="checkbox" name="tag[]" title="{$tag->name}" value="{$tag->id}" lay-skin="primary">
                    {/if}
                {/foreach}
            </div>
        </div>

        <div class="layui-form-item">
            <label for="loan_record" class="layui-form-label">
                <span class="x-red">*</span>下款人数
            </label>
            <div class="layui-input-inline">
                <input type="number" id="loan_record" name="loan_record" required="" lay-verify="required"
                       autocomplete="off" value="{$product->loan_record}" class="layui-input">
            </div>

            <label for="product_icon" class="layui-form-label">
                <span class="x-red">*</span>上传图片:
            </label>
            <div class="layui-input-inline">
                <button type="button" class="layui-btn" id="product_icon">
                    <i class="layui-icon">&#xe67c;</i>上传产品图片
                </button>
            </div>

            <div class="layui-input-inline" id="imgs">
                <img src="{$product->product_icon}" alt="" width="100" height="100">
                <input type="hidden" value="{$product->product_icon}" name="product_icon">
            </div>

        </div>

        <div class="layui-form-item">
            <label for="L_repass" class="layui-form-label">
            </label>
            <button  class="layui-btn" lay-filter="add" lay-submit="">
                修改
            </button>
        </div>
    </form>
</div>
{include file='public/footer' /}
<script>
    layui.use(['form','layer','upload'], function(){
        $ = layui.jquery;
        var form = layui.form;
        var layer = layui.layer;
        var upload = layui.upload;

        //执行实例
        var uploadInst = upload.render({
            elem: '#product_icon' //绑定元素
            ,url: '/product/upload' //上传接口
            ,done: function(res){
                //上传完毕回调
                if (res.status == 200) {
                    let img = '<img src="'+res.data+'" width="100" height="100" />' +
                        '<input type="hidden" name="product_icon" value="'+res.data+'">'
                    $('#imgs').html(img);
                    layer.msg('上传成功',{icon:6})
                } else {
                    layer.msg('上传失败',{icon:5})
                }
            }
            ,error: function(){
                //请求异常回调
            }
        });

        //监听提交
        form.on('submit(add)', function(data){
            console.log(data);
            //发异步，把数据提交给php
            $.ajax({
                url:"/product/{$product->id}",
                type:'put',
                data:data.field,
                dataType:'json',
                success:function (res) {
                    console.log(res);
                    if (res.status == 200) {
                        layer.msg(res.msg, {icon: 6});
                    }else {
                        layer.msg(res.msg,{icon:5});
                    }
                }
            });
            return false;
        });


    });
</script>
</body>
</html>